---
import Logo from "@/assets/DP_LogoText_black.svg";
import Button from "./ui/button/button.astro";
import LanguageSwitcher from "./LanguageSwitcher.astro";
import { useTranslations, getCurrentLang, getLocalizedUrl } from "@/lib/i18n";
import { Image } from "astro:assets";
import { languages } from "@/i18n/ui";

type Props = {
  reduce?: boolean;
  navHeight?: string;
  reducedNavHeight?: string;
  navBackground?: string;
};

const {
  reduce = false,
  navHeight = "h-20 md:h-28",
  reducedNavHeight,
  navBackground = "bg-transparent",
} = Astro.props as Props;

const lang = getCurrentLang(Astro.currentLocale) as keyof typeof languages;
const t = useTranslations(lang);
const navbarHeightClass = reduce ? reducedNavHeight : navHeight;
---

<!-- Mobile menu checkbox (hidden, controls the menu state) -->
<input type="checkbox" id="mobile-menu-toggle" class="peer/menu fixed hidden" />

<nav
  data-scroll-animated
  class={`fixed inset-x-0 z-40 flex ${navbarHeightClass} ${navBackground} items-center justify-between px-4 md:px-8 lg:px-20`}
>
  <!-- Logo (visible on mobile and desktop) -->
  <Button
    href={getLocalizedUrl("home", lang)}
    class="-mx-6"
    variant="link"
    aria-hidden="true"
    tabindex="-1"
  >
    <Image
      src={Logo}
      alt="Domaine de Pipangaille"
      class="w-20 bg-transparent md:w-28"
    />
  </Button>

  <!-- Desktop Navigation -->
  <ul class="-mx-6 hidden md:mx-0 lg:flex">
    <li>
      <Button
        variant="link"
        class="px-1 md:pr-2.5 lg:pr-3.5 xl:pr-6"
        href={getLocalizedUrl("home", lang)}
      >
        {t("nav.home")}
      </Button>
    </li>
    <li>
      <Button
        variant="link"
        class="px-1 md:px-2.5 lg:px-3.5 xl:px-6"
        href={getLocalizedUrl("place", lang)}
      >
        {t("nav.place")}
      </Button>
    </li>
    <li>
      <Button
        variant="link"
        class="px-1 md:px-2.5 lg:px-3.5 xl:px-6"
        href={getLocalizedUrl("accommodations", lang)}
      >
        {t("nav.accommodations")}
      </Button>
    </li>
    <li>
      <Button
        variant="link"
        class="px-1 md:px-2.5 lg:px-3.5 xl:px-6"
        href={getLocalizedUrl("counter", lang)}
      >
        {t("nav.counter")}
      </Button>
    </li>
    <li>
      <Button
        variant="link"
        class="px-1 md:px-2.5 lg:px-3.5 xl:px-6"
        href={getLocalizedUrl("surroundings", lang)}
      >
        {t("nav.surroundings")}
      </Button>
    </li>
  </ul>

  <!-- Desktop Actions -->
  <ul class="hidden items-center gap-4 lg:flex">
    <li>
      <LanguageSwitcher
        idPrefix="navbar-language-switcher"
        reduce
        class="w-full max-w-xs"
      />
    </li>
    <li>
      <Button
        variant="outline"
        class="hover:bg-background bg-transparent"
        href={getLocalizedUrl("contact", lang)}
      >
        {t("nav.contact")}
      </Button>
    </li>
    <li>
      <Button href={getLocalizedUrl("booking", lang)}>{t("nav.book")}</Button>
    </li>
  </ul>

  <!-- Mobile Burger Button -->
  <label
    for="mobile-menu-toggle"
    class="flex cursor-pointer flex-col items-center justify-center gap-1.5 lg:hidden"
    aria-label="Toggle menu"
  >
    <span
      class="bg-foreground block h-0.5 w-6 origin-center transition-all duration-300 ease-in-out peer-checked/menu:translate-y-2 peer-checked/menu:rotate-45"
    ></span>
    <span
      class="bg-foreground block h-0.5 w-6 transition-all duration-300 ease-in-out peer-checked/menu:opacity-0"
    ></span>
    <span
      class="bg-foreground block h-0.5 w-6 origin-center transition-all duration-300 ease-in-out peer-checked/menu:-translate-y-2 peer-checked/menu:-rotate-45"
    ></span>
  </label>
</nav>

<!-- Mobile Menu -->
<div
  class="bg-background fixed inset-x-0 top-0 z-30 flex h-screen w-screen translate-x-full flex-col gap-8 overflow-y-auto px-4 pt-32 transition-transform duration-300 ease-in-out peer-checked/menu:translate-x-0 lg:hidden"
>
  <ul class="flex flex-col gap-2">
    <li>
      <Button
        variant="link"
        class="-mx-6 w-full justify-start text-2xl"
        href={getLocalizedUrl("home", lang)}
      >
        {t("nav.home")}
      </Button>
    </li>
    <li>
      <Button
        variant="link"
        class="-mx-6 w-full justify-start text-2xl"
        href={getLocalizedUrl("place", lang)}
      >
        {t("nav.place")}
      </Button>
    </li>
    <li>
      <Button
        variant="link"
        class="-mx-6 w-full justify-start text-2xl"
        href={getLocalizedUrl("accommodations", lang)}
      >
        {t("nav.accommodations")}
      </Button>
    </li>
    <li>
      <Button
        variant="link"
        class="-mx-6 w-full justify-start text-2xl"
        href={getLocalizedUrl("counter", lang)}
      >
        {t("nav.counter")}
      </Button>
    </li>
    <li>
      <Button
        variant="link"
        class="-mx-6 w-full justify-start text-2xl"
        href={getLocalizedUrl("surroundings", lang)}
      >
        {t("nav.surroundings")}
      </Button>
    </li>
  </ul>

  <div class="flex flex-col gap-4">
    <LanguageSwitcher idPrefix="mobile-menu-language-switcher" class="w-full" />
    <Button
      variant="outline"
      class="w-full"
      href={getLocalizedUrl("contact", lang)}
    >
      {t("nav.contact")}
    </Button>
    <Button class="w-full" href={getLocalizedUrl("booking", lang)}
      >{t("nav.book")}</Button
    >
  </div>
</div>
