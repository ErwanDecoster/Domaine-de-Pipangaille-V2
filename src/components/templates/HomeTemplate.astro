---
import { Button } from "@/components/ui/button";
import Layout from "@/layouts/Layout.astro";
import { Bike } from "@lucide/astro";
import Header from "@/components/Header.astro";
import MediaContent from "@/components/MediaContent.astro";
import ReviewList from "@/components/ReviewList.astro";
import Card from "@/components/Card.astro";
import { useTranslations, useTranslatedPath } from "@/lib/i18n";
import { reviews } from "@/constants/reviews";
import { surroundings } from "@/constants/surroundings";

import courtyardTerraceLawn from "@/images/courtyard-terrace-lawn.jpeg";
import moroccanRoomFrenchDoor from "@/images/moroccan-room-french-door.jpeg";
import gardenCheeseAndCharcuterieBoard from "@/images/garden-cheese-and-charcuterie-board.JPG";

const { lang } = Astro.props as { lang: keyof typeof reviews };
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

type TranslationKey = Parameters<typeof t>[0];
const toKey = (key: string) => key as TranslationKey;

const formatCard = (item: (typeof surroundings.toVisit)[number]) => {
  const categories = item.category ?? [];
  const firstImage = item.gallery?.[0];

  return {
    title: item.title,
    image: firstImage?.src,
    imageAlt: t(toKey(firstImage?.altKey ?? "")),
    description: item.shortDesc ? t(toKey(item.shortDesc)) : undefined,
    tags: categories.map((cat) => ({
      text: t(toKey(`surroundings.category.${cat}`)),
    })),
    buttonText: t("surroundings.card.cta"),
    buttonLink: translatePath(`/surrounding/${item.slug}`),
  };
};
---

<Layout>
  <div data-scroll-animated class="h-28 w-screen sticky top-0 z-10 bg-muted">
  </div>
  <Header
    title={t("home.header.title")}
    text={t("home.header.text")}
    image={courtyardTerraceLawn}
    imageAlt="TODO"
    buttonText={t("home.header.button")}
    buttonLink={translatePath("/the-place")}
  />
  <div
    data-scroll-animated
    class="h-28 -mb-20 w-screen sticky top-0 z-10 bg-background"
  >
  </div>
  <MediaContent
    direction="left"
    title={t("home.rooms.title")}
    text={t("home.rooms.text")}
    image={moroccanRoomFrenchDoor}
    imageAlt="TODO"
    buttonText={t("home.rooms.button")}
    buttonLink={translatePath("/accommodations")}
  />
  <MediaContent
    title={t("home.counter.title")}
    text={t("home.counter.text")}
    image={gardenCheeseAndCharcuterieBoard}
    imageAlt="TODO"
    buttonText={t("home.counter.button")}
    buttonLink={translatePath("/the-counter")}
  />
  <ReviewList title={t("home.reviews.title")} reviews={reviews[lang]} />
  <section class="grid grid-cols-6 gap-8 md:gap-10 px-20 mt-48">
    <h2 class="mb-4 col-span-6">{t("home.surroundings.title")}</h2>
    {
      surroundings.toVisit.slice(0, 5).map((surrounding, index) => {
        const card = formatCard(surrounding);
        return (
          <Card {...card} class={index < 2 ? "col-span-3" : "col-span-2"} />
        );
      })
    }
    <Button class="col-span-6 mx-auto mt-6">
      {t("home.surroundings.button")}
    </Button>
  </section>
  <section class="px-20 my-48">
    <div class="mx-auto bg-muted px-6 py-24 max-w-5xl rounded-3xl">
      <div class="w-fit mx-auto space-y-10">
        <h3>{t("home.booking.title")}</h3>
        <div class="flex justify-between">
          <Button href="/booking">{t("home.booking.button")}</Button>
          <Button href="/booking" variant="secondary">
            {t("home.booking.secondaryButton")}
          </Button>
        </div>
      </div>
    </div>
  </section>
</Layout>
