---
import Layout from "@/layouts/Layout.astro";
import { ui } from "@/i18n/ui";

const { lang } = Astro.props as { lang: keyof typeof ui };

// Map language codes to Amenitiz language codes
const langMap: Record<string, string> = {
  fr: "fr",
  en: "en",
  de: "de",
  es: "es",
  it: "it",
  nl: "nl",
};

const amenitizLang = langMap[lang] || "fr";
const baseUrl = `https://domaine-de-pipangaille.amenitiz.io/${amenitizLang}/booking/room`;
---

<Layout
  title={`Booking - Domaine de Pipangaille`}
  reduce={true}
  reducedNavHeight="h-18"
  navBackground="bg-background"
>
  <main class="flex min-h-screen items-center justify-center pt-18">
    <iframe id="amenitizFrame" title="Amenitiz Booking" class="h-screen w-full"
    ></iframe>
  </main>

  <script define:vars={{ baseUrl }}>
    // Get query parameters from the current URL
    const params = new URLSearchParams(window.location.search);
    const startDate = params.get("start_date") || "";
    const endDate = params.get("end_date") || "";
    const adults = params.get("adults") || "1";
    const children = params.get("children") || "0";

    // Build the booking URL with parameters
    const bookingUrl = new URL(baseUrl);
    if (startDate) bookingUrl.searchParams.set("start_date", startDate);
    if (endDate) bookingUrl.searchParams.set("end_date", endDate);
    bookingUrl.searchParams.set("adults", adults);
    bookingUrl.searchParams.set("children", children);

    // Set the iframe src
    const iframe = document.getElementById("amenitizFrame");
    if (iframe instanceof HTMLIFrameElement) {
      iframe.src = bookingUrl.toString();
    } else {
      console.error("Amenitiz booking iframe not found");
    }
  </script>
</Layout>
